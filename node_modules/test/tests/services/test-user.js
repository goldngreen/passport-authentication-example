

const assert = require('assert');

const UserService = require('server/services/user').UserService;
const Database = require('server/data').Database;
const userTestData = require('test/services/test-data').user;

describe('user-service', async () => {
    const testDatabase = '.data/test.sqlite';
    const database = new Database(testDatabase);
    database.authenticate();
    database.initSchema();
    const userService = new UserService(database);


    it('should create a user', async () => {
        const sample = await userTestData.sample();
        const id = userService.createUser(sample);
        console.log(id);
    });

    it('should find a user by id', async () => {
        const sample = await userTestData.sample();
        const user = await userService.createUser(sample);
        console.log(`user is ${user}, user.id is ${user.id}`);
        const found = await userService.findById(user.id);
        console.log(`Found user: ${found}`);
    });

    it('should reject an invalid user', () => {
        const user = Object.assign({}, userTestData.sample());
        delete user.username;
        assert.throws( () => userService.createUser(user), { name: 'TypeError' } );
    });

    it('should be easy to isolate test code', () => {
    });
});